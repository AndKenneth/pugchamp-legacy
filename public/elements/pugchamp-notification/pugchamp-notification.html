<link rel="import" href="/components/polymer/polymer.html">

<dom-module id="pugchamp-notification">
    <script>
        Polymer({
            is: 'pugchamp-notification',
            properties: {
                title: {
                    type: String
                },
                direction: {
                    type: String,
                    value: 'auto'
                },
                language: {
                    type: String,
                    value: 'en'
                },
                body: String,
                icon: {
                    type: String,
                    value: '/assets/img/logo.png'
                },
                data: Object,
                sound: {
                    type: String,
                    value: '/snd/beep.wav'
                },
                vibrate: Array,
                renotify: {
                    type: Boolean,
                    value: false
                },
                silent: {
                    type: Boolean,
                    value: false
                },
                noscreen: {
                    type: Boolean,
                    value: false
                },
                sticky: {
                    type: Boolean,
                    value: false
                }
            },
            ready: function() {
                if (this.title === '') {
                    if (window.PugChampSettings) {
                        this.title = window.PugChampSettings.siteName;
                    }
                    else {
                        this.title = 'PugChamp';
                    }
                }

                if (window.Notification && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            },
            notify: function() {
                if (window.Notification && Notification.permission === 'granted') {
                    this.notification = new Notification(this.title || 'PugChamp', {
                        dir: this.direction,
                        lang: this.language,
                        body: this.body,
                        tag: this.tag,
                        icon: this.icon,
                        data: this.data,
                        sound: this.sound,
                        vibrate: this.vibrate,
                        renotify: this.renotify,
                        silent: this.silent,
                        noscreen: this.noscreen,
                        sticky: this.sticky
                    });

                    this.notification.onclick = function(event) {
                        this.fire('click', event);
                    }.bind(this);

                    this.notification.onerror = function() {
                        this.fire('error');
                    }.bind(this);
                }
            },
            close: function() {
                if (this.notification) {
                    this.notification.close();
                }
            }
        });
    </script>
</dom-module>
